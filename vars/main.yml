---
# sysctl configuration file extends sysctl.conf
__hardening_sysctl_conf: /etc/sysctl.d/98-hardening.conf

__hardening_sysctl_kernel_parameters:
  - name: fs.protected_symlinks
    value: "1"
    comment: ensure DAC on symlinks is configured
  - name: fs.protected_hardlinks
    value: "1"
    comment: ensure DAC on hardlinks is configured
  - name: fs.suid_dumpable=0
    value: "0"
    comment: disable core dumps for SUID programs
  - name: kernel.dmesg_restrict
    value: "1"
    comment: restrict access to kernel message buffer output (dmesg)
  - name: kernel.yama.ptrace_scope
    value: "2"
    comment: restrict access to ptrace
  - name: kernel.kexec_load_disabled
    value: "1"
    comment: disable kernel image loading
  - name: kernel.unprivileged_bpf_disabled
    value: "1"
    comment: disable access to bpf() syscall
  - name: net.core.bpf_jit_harden
    value: "2"
    comment: harden operations to BPF JIT compiler
  - name: kernel.core_pattern
    value: "|/bin/false"
    comment: disable storing core dumps
  - name: kernel.perf_event_paranoid
    value: "2"
    comment: disable kernel profiling by users
  - name: kernel.kptr_restrict
    value: "1"
    comment: restrict exposed kernel pointer addresses access
  - name: kernel.randomize_va_space
    value: "2"
    comment: enable randomized layout of virtual address space

__hardening_limits_conf_file: /etc/security/limits.d/98-hardening.conf

__hardening_limits_conf:
  - comment: limit core dumps for all user (hard)
    domain: "*"
    limit_item: core
    limit_type: hard
    value: "0"
  - comment: limit concurrent users and sessions per user
    domain: "*"
    limit_item: maxlogins
    limit_type: hard
    value: "{{ hardening_limits_maxlogins_count_hard }}"
  - comment: limits process count per user (soft)
    domain: "*"
    limit_item: nproc
    limit_type: soft
    value: "{{ hardening_limits_process_count_soft | int }}"
  - comment: limits process count per user (hard)
    domain: "*"
    limit_item: nproc
    limit_type: hard
    value: "{{ hardening_limits_process_count_hard | int }}"

  # file_permissions.yml
__hardening_file_perms_bin_dirs:
  - /bin
  - /sbin
  - /usr/bin
  - /usr/sbin
  - /usr/local/bin
  - /usr/local/sbin

# mount_filesystems.yml
__hardening_mount_filesystems_blacklist:
  - adfs
  - affs
  - befs
  - bfs
  - cramfs
  - efs
  - erofs
  - exofs
  - f2fs
  - freevxfs
  - hfs
  - hfsplus
  - hpfs
  - jffs2
  - jfs
  - minix
  - nilfs2
  - qnx4
  - qnx6
  - squashfs
  - sysv
  - ubifs
  - udf
  - ufs

__hardening_disabled_services:
  - autofs.service
  - debug-shell.service
  - systemd-coredump@.service
