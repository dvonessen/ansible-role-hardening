---
- name: import preflight.yml
  import_tasks: preflight.yml
  tags:
    - always

- name: include main vars.
  include_vars: main.yml
  tags:
    - always

- name: include os dependent variable file
  include_vars: "{{ item }}"
  with_first_found:
    - files:
        - "{{ ansible_os_family | lower }}.yml"
      skip: true
  tags:
    - always

- name: import pam.yml
  import_tasks: pam.yml
  become: true
  when: hardening_enable_pam_configuration | bool
  tags:
    - hardening_pam

- name: import login.yml
  import_tasks: login.yml
  become: true
  when: hardening_enable_login_configuration | bool
  tags:
    - hardening_login

- name: import limits.yml
  import_tasks: limits.yml
  become: true
  when: hardening_enable_limits_configuration | bool
  tags:
    - hardening_limits

- name: import file_permissions.yml
  import_tasks: file_permissions.yml
  become: true
  when: hardening_enable_file_perms_configuration | bool
  tags:
    - hardening_file_permissions

- name: import mount_filesystems.yml
  import_tasks: mount_filesystems.yml
  become: true
  when: hardening_enable_mount_filesystems_configuration | bool
  tags:
    - hardening_enable_mount_filesystems

- name: import sysctl.yml
  import_tasks: sysctl.yml
  become: true
  when: hardening_enable_sysctl_configuration | bool
  tags:
    - hardening_enable_sysctl_configuration

- name: import crypto_policy.yml
  import_tasks: crypto_policy.yml
  become: true
  when:
    - hardening_enable_crypto_policy_module_configuration | bool
    - ansible_os_family | lower == "redhat"
  tags:
    - hardening_enable_crypto_policy_module

- name: import services.yml
  import_tasks: services.yml
  when:
    - hardening_enable_services_configuration | bool
  tags:
    - hardening_enable_services_module

- name: import yum.yml
  import_tasks: yum.yml
  when:
    - hardening_enable_yum_configuration | bool
    - ansible_os_family | lower == "redhat"
  tags:
    - hardening_yum

# - name: import user.yml
#   import_tasks: user.yml
#   become: true
#   when: hardening_enable_user_configuration | bool
#   tags:
#     - hardening_user
